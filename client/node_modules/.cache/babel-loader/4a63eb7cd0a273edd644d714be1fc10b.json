{"ast":null,"code":"import _objectSpread from \"/home/efimenko/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/alive-empire-game/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _objectWithoutProperties from \"/home/efimenko/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/alive-empire-game/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"/home/efimenko/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/alive-empire-game/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nvar initConfig = {\n  alive: function alive() {\n    return true;\n  },\n  rules: function rules(prev) {\n    return prev;\n  },\n  name: 'init'\n};\n\nvar Engine = function Engine(canvas) {\n  var cellSize = 4;\n  var w = Math.floor(canvas.width / cellSize);\n  var h = Math.floor(canvas.height / cellSize);\n\n  var _ctx = canvas.getContext('2d');\n\n  var configs = [initConfig];\n\n  var world = _toConsumableArray(Array(w * h).keys()).map(Cell(0));\n\n  var cords = {};\n\n  var _alive;\n\n  var _rules;\n\n  var _currentLaw = 0;\n\n  var drawing = function drawing() {\n    var _cords = cords,\n        x = _cords.x,\n        y = _cords.y;\n    world[x + y * w].setState(1);\n    draw(x, y);\n  };\n\n  var init = function init() {\n    canvas.addEventListener('mousemove', function (event) {\n      var _getCords = getCords(event),\n          x = _getCords.x,\n          y = _getCords.y;\n\n      cords = {\n        x: Math.floor(x / cellSize),\n        y: Math.floor(y / cellSize)\n      };\n    });\n    canvas.addEventListener('mousedown', function (event) {\n      drawing();\n      canvas.addEventListener('mousemove', drawing);\n    });\n    canvas.addEventListener('mouseup', function () {\n      canvas.removeEventListener('mousemove', drawing);\n    });\n  };\n\n  init();\n\n  var Cell = function Cell(state) {\n    var law = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'init';\n    return function (index) {\n      var j = Math.floor(index / w);\n      var i = index % w;\n      var _law = law;\n\n      var c = function c(i, j) {\n        var _i = i < 0 ? 0 : i < w ? i : w - i;\n\n        var _j = j < 0 ? 0 : j < h ? j : h - j;\n\n        return _i + _j * w;\n      };\n\n      var _state = state;\n\n      var setState = function setState(s) {\n        return _state = s;\n      };\n\n      var getState = function getState() {\n        return _state;\n      };\n\n      var getLaw = function getLaw() {\n        return _law;\n      };\n\n      var siblings = function siblings() {\n        return [world[c(i - 1, j - 1)], world[c(i - 1, j)], world[c(i - 1, j + 1)], world[c(i, j - 1)], world[c(i, j + 1)], world[c(i + 1, j - 1)], world[c(i + 1, j)], world[c(i + 1, j + 1)]];\n      };\n\n      return {\n        getState: getState,\n        siblings: siblings,\n        index: index,\n        setState: setState,\n        getLaw: getLaw\n      };\n    };\n  };\n\n  var setConfig = function setConfig(name) {\n    var _configs$name = configs[name],\n        alive = _configs$name.alive,\n        rules = _configs$name.rules;\n    _alive = alive;\n    _rules = rules;\n    _currentLaw = name;\n  };\n\n  var addConfig = function addConfig(_ref) {\n    var name = _ref.name,\n        config = _objectWithoutProperties(_ref, [\"name\"]);\n\n    configs[name] = _objectSpread({}, config, {\n      id: configs.length\n    });\n  };\n\n  var getCords = function getCords(event) {\n    return {\n      x: event.pageX - canvas.offsetLeft,\n      y: event.pageY - canvas.offsetTop\n    };\n  };\n\n  var next = function next(cell) {\n    var prev = cell.getState();\n    setConfig(cell.getLaw());\n    var res = cell.siblings().reduce(function (a, x) {\n      return a + x;\n    });\n    return Cell(_rules(prev, res, _alive))(cell.index);\n  };\n\n  var epoch = function epoch() {\n    world = world.map(next);\n  };\n\n  var draw = function draw(i, j) {\n    var state = world[i + j * w].getState();\n    var id = configs[world[i + j * w].getLaw()].id;\n\n    _ctx.beginPath();\n\n    _ctx.fillStyle = \"rgb(\".concat(state * id * 30, \",\").concat(state * id * 50, \",\").concat(state * id * 180, \")\");\n\n    _ctx.arc(i * cellSize, j * cellSize, cellSize / 2, 0, Math.PI * 2);\n\n    _ctx.fill();\n  };\n\n  var render = function render() {\n    epoch();\n\n    _ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    for (var i = 0; i < w; ++i) {\n      for (var j = 0; j < h; ++j) {\n        if (_alive(world[i + j * w].getState())) {\n          draw(i, j);\n        }\n      }\n    }\n  };\n\n  return {\n    render: render,\n    setConfig: setConfig\n  };\n};\n\nexport default Engine;","map":{"version":3,"sources":["/home/efimenko/Рабочий стол/alive-empire-game/src/engine/index.js"],"names":["initConfig","alive","rules","prev","name","Engine","canvas","cellSize","w","Math","floor","width","h","height","_ctx","getContext","configs","world","Array","keys","map","Cell","cords","_alive","_rules","_currentLaw","drawing","x","y","setState","draw","init","addEventListener","event","getCords","removeEventListener","state","law","index","j","i","_law","c","_i","_j","_state","s","getState","getLaw","siblings","setConfig","addConfig","config","id","length","pageX","offsetLeft","pageY","offsetTop","next","cell","res","reduce","a","epoch","beginPath","fillStyle","arc","PI","fill","render","clearRect"],"mappings":"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","sourcesContent":["\nconst initConfig = {\n\talive: () => true,\n\trules: prev => prev,\n\tname: 'init'\n}\n\nconst Engine = (canvas) => {\n\tconst cellSize = 4\n\tconst w = Math.floor(canvas.width / cellSize)\n\tconst h = Math.floor(canvas.height / cellSize)\n\tconst _ctx = canvas.getContext('2d')\n\t\n\tconst configs = [ initConfig ]\n\tlet world = [...Array(w*h).keys()].map(Cell(0))\n\tlet cords = {}\n\tlet _alive;\n\tlet _rules;\n\tlet _currentLaw = 0;\n\t\n\tconst drawing = () => {\n\t\tconst {x ,y} = cords;\n\t\tworld[x + y * w].setState(1)\n\t\tdraw(x, y)\n\t}\n\t\tconst init = () => {\n\t\tcanvas.addEventListener('mousemove',(event) =>{\n\t\t\tconst {x, y} = getCords(event)\n\t\t\tcords = {x: Math.floor(x / cellSize), y: Math.floor(y / cellSize)}\n\t\t});\n\t\tcanvas.addEventListener('mousedown',(event) =>{\n\t\t\tdrawing()\n\t\t\tcanvas.addEventListener('mousemove', drawing);\n\t\t});\n\t\tcanvas.addEventListener('mouseup', () => {\n\t\t\tcanvas.removeEventListener('mousemove',drawing);\n\t\t});\n\t}\n\tinit()\n\n\tconst Cell = (state, law = 'init') => (index) => {\n\t\tconst j = Math.floor(index / w)\n\t\tconst i = index % w\n\t\tconst _law = law;\n\t\tconst c = (i, j) => {\n\t\t\tconst _i = i < 0 ? 0: i < w ? i : w - i\n\t\t\tconst _j = j < 0 ? 0: j < h ? j : h - j\n\t\t\treturn _i + _j * w\n\t\t}\n\t\tlet _state = state;\n\t\tconst setState = (s) => _state = s\n\t\tconst getState = () => _state\n\t\tconst getLaw = () => _law\n\t\tconst siblings = () => [\n\t\t\tworld[c(i - 1, j - 1)],\n\t\t\tworld[c(i - 1, j)],\n\t\t\tworld[c(i - 1, j + 1)],\n\t\t\tworld[c(i, j - 1)],\n\t\t\tworld[c(i, j + 1)],\n\t\t\tworld[c(i + 1, j - 1)],\n\t\t\tworld[c(i + 1, j)],\n\t\t\tworld[c(i + 1, j + 1)]\n\t\t] \n\t\treturn {\n\t\t\tgetState,\n\t\t\tsiblings,\n\t\t\tindex,\n\t\t\tsetState,\n\t\t\tgetLaw,\n\t\t}\n\t}\n\n\tconst setConfig = (name) =>{\n\t\t const { alive, rules } = configs[name]\n\t\t _alive = alive;\n\t\t _rules = rules\n\t\t _currentLaw = name\n\t}\n\tconst addConfig = ({ name, ...config }) => {\n\t\tconfigs[name] = { ...config, id: configs.length }\n\t}\n\n\t\n\tconst getCords = event => {\n\t\treturn {\n\t\t\tx:event.pageX - canvas.offsetLeft,\n\t\t\ty:event.pageY - canvas.offsetTop\n\t\t}\n\t}\n\n\tconst next = (cell) => {\n\t\tconst prev = cell.getState()\n\t\tsetConfig(cell.getLaw())\n\t\tconst res =  cell.siblings().reduce((a,x) => a + x)\n\t\treturn Cell(_rules(prev, res, _alive))(cell.index)\n\t}\n\n\tconst epoch = () => {\n\t\tworld = world.map(next)\n\t}\n\n\tconst draw = (i, j) => {\n\t\tconst state = world[i + j * w].getState()\n\t\tconst id = configs[world[i + j * w].getLaw()].id\n\t\t_ctx.beginPath()\n\t\t_ctx.fillStyle = `rgb(${ state * id * 30 },${ state * id * 50 },${ state * id *180 })`\n\t\t_ctx.arc(i*cellSize,j*cellSize,cellSize / 2, 0, Math.PI * 2)\n\t\t_ctx.fill()\t\n\t}\n\n\tconst render = () =>  {\n\t\tepoch()\n\t\t_ctx.clearRect(0, 0, canvas.width, canvas.height)\n\t\tfor (let i = 0; i < w; ++i){\n\t\t\tfor (let j = 0; j < h; ++j){\n\t\t\t\tif (_alive(world[i + j*w].getState())) {\n\t\t\t\t\tdraw(i,j)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn {\n\t\trender,\n\t\tsetConfig\n\t}\n}\n\n\n\n\nexport default Engine\n\n"]},"metadata":{},"sourceType":"module"}